> 摘自aliyun
>
> https://help.aliyun.com/product/48444.html?spm=a2c4g.11186623.6.540.497245e1KDOvpC

### 产品概述

全局事务服务（Global Transaction Service，简称 GTS）是一款高性能、高可靠、接入简单的分布式事务中间件，用于解决分布式环境下的数据一致性问题。

一个完整的业务往往需要调用多个子业务或服务，随着业务的不断增多，涉及的服务及数据也越来越多，越来越复杂。传统的系统难以支撑，出现了应用和数据库等的分布式系统。分布式系统又带来了数据一致性的问题，从而产生了分布式事务。

分布式事务是指事务发起者、资源管理器、事务协调者及资源分别位于不同的分布式系统的不同节点之上。

GTS 的架构如下图所示：

[![GTS 架构](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/48726/cn_zh/1498619797175/GTS%20%E6%9E%B6%E6%9E%84.png)](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/48726/cn_zh/1498619797175/GTS 架构.png)

- GTS 服务端：即事务协调器。负责分布式事务的推进，管理事务生命周期。
- GTS 客户端：即事务发起者。通过事务协调器，开启、提交、回滚分布式事务。同时还包含部分资源管理器组件，负责管理和控制资源，与 GTS 服务器进行交互。
- 服务框架：GTS 可以服务框架配合使用，管理服务框架中的事务。服务框架可以集成资源管理器组件，管理和控制资源。
- 资源： 包括 RDS、DRDS、MySQL 以及其它数据库事务，还包括 MQ 消息事务。

说明：服务端的 GTS 相关配置通过内部组件进行下发或同步。

在单机数据库下很容易维持事务的 ACID（Atomicity、Consistency、Isolation、Durability）特性，但在分布式系统中并不容易，GTS 可以保证分布式系统中的分布式事务的 ACID 特性。

GTS 支持 DRDS、RDS、Oracle、MySQL、PostgreSQL、OceanBase 和 Petadata 等多种数据源，可以配合 EDAS、Dubbo 和 Spring Cloud 等微服务框架使用， 兼容 MQ 实现事务消息。通过各种组合，可以轻松实现分布式数据库事务、多库事务、消息事务、服务链路级事务等多种业务需求。

### 应用场景

#### 解决跨服务事务问题

现代 IT 应用中，服务化的模式得到了广泛使用。比如大型电商应用中，为了系统解耦，常常将整个应用划分为多个系统，如商品系统、商家系统、用户系统、账务系统、物流系统等，各个系统会提供各自的服务。

商品加入购物车的操作，会调用商品系统服务来减掉库存，调用购物车系统服务增加记录，调用结算系统服务变更待结算金额等操作。使用 GTS 可以将调用这些服务的操作加入到一个全局事务中，让他们要么同时成功，要么同时失败，保证了各个系统的数据一致性。

[![GTS EDAS 场景](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/48729/cn_zh/1498546429963/gts-scenario_inter-edas.png)](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/48729/cn_zh/1498546429963/gts-scenario_inter-edas.png)

#### GTS 配置 MQ 解决事务消息问题

有些应用系统在使用数据库保证系统内数据一致的同时, 也会使用消息队列（MQ） 和其他系统间进行消息传递, 保证不同系统间的数据一致。

一个典型的场景，A 系统成功将本地数据 1 保存到数据库后， 通过 MQ 向 B 系统发送一条通知消息， B 系统收到消息后保存与数据 1 关联的数据 2， A、B 两个系统保持数据一致。但是当 A 系统成功保存数据但是未能成功调用消息系统发送通知时, 会导致 A 系统中有数据 1 而 B 系统中没有相应的数据 2, 即 A、B 两个系统出现数据不一致， 造成系统故障。

对于上述类似场景，GTS 能够将 A 系统向数据库写入数据 1 的本地事务, 和通过 MQ 向 B 系统发送通知放到一个全局事务中, 保证数据写入则消息一定发出，数据未写入则消息一定不会发出。

[![GTS MQ 场景](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/48729/cn_zh/1498546596302/gts-scenario_inter-mq.png)](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/48729/cn_zh/1498546596302/gts-scenario_inter-mq.png)

### 产品功能

GTS 主要能够解决以下三方面的问题：

- 跨数据库的分布式事务

  业务初始阶段往往规模比较小，大多情况下，单库就可以满足需求。经过一段时间后，业务规模也会随之变得大而复杂，会出现分库的情况，这时原有的单机事务往往会变成分布式事务。使用 GTS 可以让您像使用传统单机数据库事务一样，轻松接入分布式事务，且代码改动成本极低。

- 跨消息和数据库的分布式事务

  在某些业务场景中，需要进行多个 DB 操作的同时，还会调用消息系统，DB 操作成功、消息发送失败或者反过来都会造成业务的不完整。GTS 可以让您轻松解决消息系统和数据库的事务，将各个资源加入事务范畴。

- 跨服务的分布式事务

  业务完成服务化后，资源与客户端调用解耦，同时又要保证多个服务调用间资源的变化保持强一致，否则会造成业务数据的不完整。GTS 支持跨服务的事务，无论您使用的是 Dubbo、EDAS，还是 Spring Cloud 服务框架，都可以接入事务，让您的服务操作没有事务的后顾之忧。

### 产品优势

#### 简单易用、侵入性极低

GTS 让应用开发者不再需要考虑复杂的事务问题，仅需简单配置及一句 GTS 注解（@TxcTransaction）就能帮您轻松实现分布式事务，对已有业务代码无侵入。

#### 高性能

GTS 通过大量创新，解决了事务 ACID 特性与高性能、高可用、低侵入不可兼得的问题。单事务分支的平均响应时间在 2ms 左右，3 台服务器组成的集群可以支撑 3 万 TPS 以上的分布式事务请求。

#### 高可用、高可靠

GTS 解决了 XA 事务协调器单点问题，在应用宕机、节点故障等各类异常情况均可保证数据严格一致。中间状态多份落盘存储，经过严格断电测试，严格保证数据一致性。

#### 支持广泛

支持 RDS、MySQL、PostgreSQL、OceanBase、Petadata 等多种数据源，并可以配合 EDAS、Dubbo、Spring Cloud 及多种私有 RPC 框架使用，同时还兼容 MQ 等中间件产品。

### 名次解释

本文主要对 GTS 涉及的专有名词及术语进行定义和解析，方便您更好地理解相关概念并使用 GTS。

- 事务 （Transaction）

  事务，是指作为单个逻辑工作单元执行的一系列操作，要么完全执行，要么完全不执行。

- 分布式事务

  事务的发起者、资源及资源管理器和事务协调者分别位于不同的分布式系统的不同节点之上。

- 事务分支

  一个分布式事务可能包含多个数据库本地事务，在 GTS 框架下，分支可能是一个分库上执行的 SQL 语句，或是一个自定义模式服务的调用。

- 事务边界

  分布式事务需要进行开启，在执行结束后需要进行结束（提交或回滚），事务开启和关闭即划定了一个事务边界。

- 事务模式

  GTS 提供的预先定义好的事务模式，不同的事务模式提供了不同的易用性和性能，不同的事务模式组合（详见最佳实践）可解决极度复杂的场景。

- 事务分组

  每个 GTS 应用都需要申请一个事务分组名称，这个唯一名称由客户指定的参数部分以及系统数据组成。

- 事务别名

  事务别名为客户应用中可自定义的标识部分，放在 @TxcTransaction 注解中用于标识运行中某块事务是否开启全局事务，此名称可以在控制台上看到。

- 事务实例名

  事务实例名为客户应用中开启事务的代码块的标识，可以帮助用户了解应用的哪部分代码开启了全局事务，此名称可以在控制台上看到。

- 事务发起者

  即 GTS 客户端，通过事务协调器开启／提交分布式事务。

- ACID

  数据库事务正确执行的四个特性的缩写。包含：原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）、持久性（Durability）。

  一个支持事务的数据库，必需要具有这四种特性，否则在事务过程当中无法保证数据的正确性，交易过程极可能达不到交易方的要求。

- 两阶段提交

  两阶段提交（Two-Phase Commit protocol，2PC）协议是分布式事务的处理协议。

- XID

  XID，即 GTS 分布式事务的全局事务 ID，GTS 服务会为每一个分布式事务生成一个全局唯一的分布式事务 ID。由于其全局唯一性，我们可以通过 GTS 日志中的 XID 帮助排查问题。

- BranchId

  BranchId，即 GTS 分布式事务的分支事务 ID，它是事务分支的唯一标识。XID 和 BranchId 是一对多的包含关系，即一个全局事务可能包含多个事务分支。通过在 GTS 日志中跟踪某个 BranchId，可以帮助排查问题，观察事务分支提交和回滚的原因。

- GlobalCommit

  全局事务提交，GTS 中用于表示一个全局事务中所有操作提交了。

- GlobalRollback

  全局事务回滚，GTS 中用于表示一个全局事务中所有操作回滚了。

- BranchCommit

  分支事务提交，GTS 中用于表示一个全局事务的某个分支操作提交了。

- BranchRollback

  分支事务回滚，GTS 中用于表示一个全局事务的某个分支操作回滚了。