todo 数据权限得去每个模块修改


### api层的类结构

1. 权限数据存放在domain-user-center-api层通过枚举来存储
2. DataSubModulePermission和FuncSubModulePermission差一个字段
    DataSubModulePermission
        PermissionKey
        PermissionName
        Authority
        PermissionLevel
        OldVersionId
    FuncSubModulePermission
        PermissionKey
        PermissionName
        Authority
        OldVersionId

Module
    -getModuleKey 模块id
    -getModtodouleName 模块名
    -getModuleBit 模块bit
SubModule extends Module
    -getSubModulePermission 获取具体权限的class
FuncSubModule extends SubModule
DataSubModule extends SubModule


SubModulePermission
    -getPermissionKey 权限key
    -getPermissionName 权限名称
    -getAuthority  权限编码
    -getPermissionLevel 权限等级
    -getOldVersionId  旧版本versionId


 * 权限规范：
 * 一共8位，分组1   2-3   4-5    6-8
 * 第1位： 1：功能权限    2：数据权限
 * 第2-3位： 是大的功能模块
 * 当是功能权限的时候  01：首页  02：订单  03：物料  04：计划  05：采购  06：企业  07：财务  08：库存  09：项目  10：生产  11： 设置
 * 当时数据权限的时候  01：物料  02：企业  03：库存  04：价格  05:生产
 * 第4-5位： 为具体的子功能模块  由各个模块自己配置
 * 第6-8为： 为具体的权限  由各个模块自己配置

FuncPermissionModuleEnum                         1
    +INDEX_PAGE   首页                           01
        +INDEX_PAGE_CHART                       首页图表
            +HOME_CHART_ORDER                                    查看订单图表               1
            +HOME_CHART_PURCHASE                                 查看采购图表               2
            +HOME_CHART_WIP                                      查看生产图表               3
    +ORDER        订单                           02
        +ORDER                                  订单
        +ORDER_DELIVERY_APPLICATION             发货申请
        +ORDER_RETURN_RECORD                    退货记录
        +ORDER_INVOICE_RECORD                   开票记录
        +ORDER_RECEIPT_RECORD                   收款记录
        +ORDER_TO_DELIVERY_LIST                 待发货列表
        +ORDER_CUSTOMER_STATISTICS              客户订货统计
        +ORDER_ITEM_STATISTICS                  订单产品统计
        +ORDER_DELIVERED_STATISTICS             订单发货统计
        +ORDER_STAFF_SALE_STATISTICS            员工销售统计
        +ORDER_PENDING_DELIVERED_STATISTICS     待发货产品统计
        +ORDER_OVERDUE_UNDELIVERED_STATISTICS   逾期未发货统计
    +MATERIAL     物料                           03
        +MATERIAL                               物料
        +MATERIAL_CATEGORY                      物料分类
        +MATERIAL_SALES_PRICE                   销售价目表
        +MATERIAL_SPECIFICATION                 规格模板
        +MATERIAL_UNIT                          单位管理
        +MATERIAL_PROCUREMENT_PRICE             采购价目表
        +MATERIAL_PROCUREMENT_INFO              采购信息
    +PLAN         计划                           04
        +MRP                                    MRP
    +PROCUREMENT  采购                           05
        +PROCUREMENT                            采购单
        +PROCUREMENT_RECEIVE_APPLICATION        收货申请
        +PROCUREMENT_RETURN_RECORD              退货记录
        +PROCUREMENT_PAYMENT_RECORD             付款记录
        +PROCUREMENT_SHOPPING_LIST              采购清单
        +PROCUREMENT_TO_RECEIVER_LIST           待收货列表
        +PROCUREMENT_STATISTIC                  采购统计
        +PROCUREMENT_PRODUCT_STATISTIC          采购商品统计
        +PROCUREMENT_INVOICE                    发票记录
        +PROCUREMENT_RECEIVE_LIST               收料历史记录
        +PROCUREMENT_OVERDUE_UNDELIVERED_STATISTIC逾期未到货统计
    +ENTERPRISE   企业                           06
        +CUSTOMER                               客户
        +CUSTOMER_CATEGORY                      客户分类
        +SUPPLIER                               供应商
        +SUPPLIER_CATEGORY                      供应商分类
    +FINANCE      财务                           07
        +CUSTOMER_ACCOUNTS                      客户账款
        +SUPPLIER_ACCOUNTS                      供应商账款
        +RECEIVE_PAYMENT                        收付款记录
        +FINANCE_DATA                           财务数据
        +ORDER_INVOICE_MANAGE                   销售发票
        +PROCUREMENT_INVOICE_MANAGE             采购发票
    +INVENTORY    库存                           08
        +MANAGEMENT                             库存管理
        +TASK                                   库存任务
        +HISTORY                                出入库历史
        +BALANCE                                库存结存
        +CHECK_LIST                             盘点单
        +WAREHOUSE_INFO                         仓库信息
        +ANALYSIS                               库存分析
        +WMS                                    WMS对接
        +REQUISITION                            库存申请
    +PROJECT      项目                           09
        +PROJECT                                项目
    +PRODUCTION   生产                           10
        +PROCEDURE_SET                          生产工艺
        +MACHINE                                设备
        +BOM                                    BOM
        +WORK_ORDER                             生产单
        +STAFF_STATISTIC                        员工产能表
        +
        +OUTSOURCE_ORDER                        委外单
        +OUTSOURCE_ORDER_STATISTIC              委外统计
        +WORK_CALENDAR                          工作日历
        +RESOURCE                               资源
        +WORK_CENTER                            工作中心
        +COST_CENTER                            成本中心
        +PROCEDURE                              标准工序
        +PRODUCTION_PROCESS                     生产流程
        +ROUTING                                工艺路线
        +WORP_ACTIVITY                          报工
        +DEBUG_STATISTIC                        员工调机时间统计
    +SETTING      设置                           11
        +COMPANY                                公司信息
        +USER_MANAGE                            用户管理
        +ROLE_MANAGE                            角色管理
        +GROUP                                  小组
        +ADDRESS                                地址
        +BANK_ACCOUNT                           银行账号
        +SYSTEM_SETTING                         系统设置
        +CURRENCY                               多币种
        +WORK_FLOW                              流程设置
        +ORDER_APPROVAL                         订单-流程设置
        +PROCUREMENT_ORDER_APPROVAL             采购单-流程设置
        +PROCUREMENT_QC_RELEASE_ORDER_APPROVAL  收料检验放行流程设置
        +PROCUREMENT_SPECIAL_ORDER_APPROVAL     特采流程设置
        +REQUISITION_ORDER_APPROVAL             库存申请-流程设置
    +QUALITY      质量                           12
        +RECEIVE_INSPECTION_SCHEME              收料检验方案
        +RECEIVE_INSPECTION_STANDARD            收料检验规范
        +INSPECTION_PENDING_LIST                待检列表
        +RECEIVE_INSPECTION_QC_ORDER            收料检验单
        +INSPECTION_RELEASE_ORDER               放行申请单
        +RECEIVE_INSPECTION_PENDING_UNQUALIFIED_QC 收料待处理不合格列表
        +RECEIVE_INSPECTION_UNQUALIFIED_QC      收料不合格处理单
        +PRODUCTION_INSPECTION_QC_ORDER         生产检验单
        +PRODUCTION_INSPECTION_SCHEME           生产检验方案
        +PRODUCTION_IINSPECTION_STANDARD        生产检验规范
        +PRODUCTION_INSPECTION_PENDING_UNQUALIFIED_QC 生产待处理不合格列表
        +PRODUCTION_INSPECTION_UNQUALIFIED_QC   生产不合格处理单
        +QUALITY_REPORT                         质量报表


    
 DataPermissionModuleEnum                        2
    +MATERIAL     物料                           01
        +VIEW_MATERIAL                          查看物料
            +MATERIAL_ALL_RETRIEVE                               全部                    1
            +MATERIAL_PRODUCT_RETRIEVE                           查看产品                 2
            +MATERIAL_SEMI_RETRIEVE                              查看半成品               2
            +MATERIAL_RAW_MATERIAL_RETRIEVE                      查看原料                 2
            +MATERIAL_WORK_IN_PROCESS_RETRIEVE                   查看在制品               2
        +CREATE_MATERIAL                        创建物料
            +MATERIAL_ALL_CREATE                                 全部                     1
            +MATERIAL_PRODUCT_CREATE                             创建产品                  2
            +MATERIAL_SEMI_CREATE                                创建半成品                2
            +MATERIAL_RAW_MATERIAL_CREATE                        创建原料                  2
            +MATERIAL_WORK_IN_PROCESS_CREATE                     创建在制品                2
    +ENTERPRISE   企业                           02
        +QUERY_CUSTOMER                         客户查询
            +CUSTOMER_ALL_RETRIEVE                               查看全部客户              1
            +CUSTOMER_MY_RETRIEVE                                我负责                   2
        +QUERY_SUPPLIER                         供应商查询
            +SUPPLIER_ALL_RETRIEVE                               查看全部供应商            1
            +SUPPLIER_MY_RETRIEVE                                我负责                   2
    +INVENTORY    库存                           03
        +VIEW_INVENTORY                         库存管理查询
            +INVENTORY_MANAGE_All_RETRIEVE                       全部                     1
            +INVENTORY_MANAGE_MY_WAREHOUSE_RETRIEVE              本人为仓库负责人           2
    +PRICE        价格                           04
        +VIEW_GOODS_PRICE                       能否查看商品价格
            +PRICE_ITEM_PRICE_RETRIEVE_ALLOW                     允许                     1
        +VIEW_COST_PRICE                        能否查看成本价格
            +PRICE_COST_PRICE_RETRIEVE_ALLOW                     允许                     1
    +PRODUCTION   生产                           05
        +VIEW_WORK_ORDER_LIST                   生产单列表查看
            +WORK_ORDER_All_RETRIEVE                             全部                     1
            +WORK_ORDER_PERSON_IN_CHARGE_RETRIEVE                本人为生产单负责人         2
            +WORK_ORDER_EXECUTORS_RETRIEVE                       本人为生产单执行人         2
        +VIEW_MATERIAL_REQUISITION_LIST         领料任务列表查看
            +MATERIAL_REQUISITION_All_RETRIEVE                   全部                     1
            +MATERIAL_REQUISITION_PERSON_IN_CHARGE_RETRIEVE      本人为生产单负责人         2
            +MATERIAL_REQUISITION_EXECUTORS_RETRIEVE             本人为生产单执行人         2


### domain层的类结构

BasePermissionComponent

        // 如：DataPermissionModuleEnum.PRODUCTION
        protected Module module;
        // 具体枚举类
        protected Class<? extends SubModule> subModule;
        // 
        protected Map<String, List<AbstractPermissionValue>> permissions;








### 数据库设计
---
module
+ id
+ module_key
+ module_name
+ module_bit
+ module_type
+ create_time
+ update_time

CREATE TABLE `module` (
  `id` bigint(14) unsigned NOT NULL AUTO_INCREMENT,
  `module_key` varchar(36) NOT NULL COMMENT '模块键',
  `module_name` varchar(36) NOT NULL COMMENT '模块名称',
  `module_bit` varchar(3) NOT NULL COMMENT '模块位码',
  `module_type` tinyint(1) NOT NULL COMMENT '模块类别 1 func 2 data',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '条目创建时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '条目最后更新时间',
  `is_deleted` tinyint(2) NOT NULL DEFAULT '0' COMMENT '条目逻辑删除',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT '主模块';

insert into module (module_key,module_name,module_bit,module_type) 
values
('INDEX_PAGE','首页','1',1),
('ORDER','订单','2',1),
('MATERIAL','物料','3',1),
('PLAN','计划','4',1),
('PROCUREMENT','采购','5',1),
('ENTERPRISE','企业','6',1),
('FINANCE','财务','7',1),
('INVENTORY','库存','8',1),
('PROJECT','项目','9',1),
('PRODUCTION','生产','10',1),
('SETTING','设置','11',1),
('QUALITY','质量','12',1),
('MATERIAL','物料','1',2),
('ENTERPRISE','企业','2',2),
('INVENTORY','库存','3',2),
('PRICE','价格','4',2),
('PRODUCTION','生产','5',2);

---
sub_module
+ id
+ module_key
+ module_name
+ module_bit
+ root_module_id
+ create_time
+ update_time

CREATE TABLE `sub_module` (
  `id` bigint(14) unsigned NOT NULL AUTO_INCREMENT,
  `module_key` varchar(36) NOT NULL COMMENT '子模块键',
  `module_name` varchar(36) NOT NULL COMMENT '子模块名称',
  `module_bit` varchar(3) NOT NULL COMMENT '子模块位码',
  `root_module_id` bigint(14) NOT NULL COMMENT '主模块id',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '条目创建时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '条目最后更新时间',
  `is_deleted` tinyint(2) NOT NULL DEFAULT '0' COMMENT '条目逻辑删除',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT '子模块';



---
sub_module_permission
+ id
+ permission_key
+ permission_name
+ authority
+ permission_level
+ old_version_id
+ sub_module_id
+ create_time
+ update_time

CREATE TABLE `sub_module_permission` (
  `id` bigint(14) unsigned NOT NULL AUTO_INCREMENT,
  `permission_key` varchar(36) NOT NULL COMMENT '权限键',
  `permission_name` varchar(36) NOT NULL COMMENT '权限名称',
  `authority` varchar(3) NOT NULL COMMENT '子模块位码',
  `permission_level` tinyint(1) NOT NULL COMMENT '数据权限层级',
  `old_version_id` int(11) NOT NULL COMMENT '旧版本versionId',
  `sub_module_id` bigint(14) NOT NULL COMMENT '所属子模块id'，
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '条目创建时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '条目最后更新时间',
  `is_deleted` tinyint(2) NOT NULL DEFAULT '0' COMMENT '条目逻辑删除',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT '子模块权限';
功能权限url
method










